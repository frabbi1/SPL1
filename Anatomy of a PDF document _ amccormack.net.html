<!DOCTYPE html>
<!-- saved from url=(0064)https://amccormack.net/2012-01-22-anatomy-of-a-pdf-document.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

    <title>Anatomy of a PDF document | amccormack.net</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script id="twitter-wjs" src="./Anatomy of a PDF document _ amccormack.net_files/widgets.js.download"></script><script async="" src="./Anatomy of a PDF document _ amccormack.net_files/analytics.js.download"></script><script src="./Anatomy of a PDF document _ amccormack.net_files/ga.js.download"> </script>
<link href="./Anatomy of a PDF document _ amccormack.net_files/bootstrap.min.css" rel="stylesheet">
<link href="./Anatomy of a PDF document _ amccormack.net_files/css" rel="stylesheet" type="text/css">
<link href="./Anatomy of a PDF document _ amccormack.net_files/css(1)" rel="stylesheet" type="text/css">
<style>
body {
    font-family: Open Sans;
    background-image: url("/static/img/greydots.png");
}
h1, h2, h3, h4 {
    font-family: Yanone Kaffeesatz;
}
hr {
    border: solid 2px #E7DBBE;
}
.container {
    background-color: #fff;
    margin-top: 10px;
    box-shadow: 10px 10px 5px #888888;
}
@media (min-width: 1200px) {
  .container {
    width: 970px;
  }
}
.footer {
    margin-top: 50px;
    font-size: 11px;
    text-align: center;
}
/* Sidebar modules for boxing content */
.sidebar-module {
  padding: 10px;
  margin: 0 10px 10px;
}
.sidebar-module-inset {
  padding: 10px;
  background-color: #f5f5f5;
  border-radius: 4px;
}
.sidebar-module-inset p:last-child,
.sidebar-module-inset ul:last-child,
.sidebar-module-inset ol:last-child {
  margin-bottom: 0;
}
.blog-header {
  padding-top: 20px;
  padding-bottom: 20px;
}
.blog-title {
  margin-top: 30px;
  margin-bottom: 0;
  font-size: 60px;
  font-weight: normal;
}
.blog-description {
  font-size: 20px;
  color: #999;
}
.highlight pre code * {
  white-space: nowrap;    // this sets all children inside to nowrap
}

.highlight pre {
  overflow-x: auto;       // this sets the scrolling in x
}

.highlight pre code {
  white-space: pre;       // forces <code> to respect <pre> formatting
}
pre{
  word-wrap: normal;
}

</style>
<script type="text/javascript" charset="utf-8" async="" src="./Anatomy of a PDF document _ amccormack.net_files/timeline.fe37195db6188934961bb169bf5784a6.js.download"></script></head>
<body>
<div class="container">
  <div class="blog-header">
    <h1 class="blog-title">amccormack.net</h1>
    <p class="lead blog-description">Things I've learned and suspect I'll forget.</p>
  </div>
  <div class="row">
    <div class="col-sm-8">
        
<div class="hero-unit faq">
    <div class="ac">
        <h2>Anatomy of a PDF document <small>2012-01-22</small></h2>
    </div>
</div>

<div>
    <p>This post contains a line by line analysis of the structure of a sample PDF. I wrote it so that I could gain a better understanding of the PDF document. The example PDF is taken from a <a href="http://blog.didierstevens.com/2008/04/09/quickpost-about-the-physical-and-logical-structure-of-pdf-files/">simpler explanation by Didier Stevens</a>. The rest of the details are filled in by the <a href="http://www.adobe.com/devnet/pdf/pdf_reference.html">Adobe PDF Specification</a>. I must admit that much of this post is a gross plagiarism of the PDF Specification and I would describe it merely as a structural change so that a PDF can be explained line by line. There are a lot of topics concerning PDFs which I don't explain or reference because I intended this post only to explain this specific PDF and not all PDFs in general. I have two forms of the PDF available. They are the exact same file with different extensions. There is the <a href="https://amccormack.net/static/attachments/hello-world.pdf">PDF Version</a> and the <a href="https://amccormack.net/static/attachments/hello-world.txt">TXT Version</a>. You should be able to edit these files with a basic text editor such as notepad. The PDF is delicate and relies heavily on byte-offsets, so you should be sure to check the values in your cross-reference table and trailer if you decide to edit the file.</p>
<p>The file structure of a PDF is made up of 4 distinct elements:</p>
<ul>
<li>A one-line <em>header</em> identifying the version of the PDF and the <a href="http://en.wikipedia.org/wiki/Magic_number_(programming)">PDF Magic Number</a></li>
<li>A <em>body</em> containing the hierarchical objects that make up the document contained in the file.</li>
<li>A <em>cross-reference table</em> which gives the address about the objects in the file</li>
<li>A <em>trailer</em> giving the location of the cross reference table.</li>
</ul>
<p>The body is a list of sequential indirect objects and is hierarchical. That is, the objects in the body point to other objects, making a tree-like structure. The root of this tree is called the Document Catalog and it contains references to other important objects throughout the document. An example image from the PDF Specification is shown:</p>
<p><img alt="&quot;Structure of a PDF Document&quot;" src="./Anatomy of a PDF document _ amccormack.net_files/StructureOfPDFDoc.png"></p>
<p>An example of a PDF is given below.</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>%PDF-1.7

1 0 obj
&lt;&lt;
 /Type /Catalog
 /Outlines 2 0 R
 /Pages 3 0 R
&gt;&gt;
endobj

2 0 obj
&lt;&lt;
 /Type /Outlines
 /Count 0
&gt;&gt;
endobj

3 0 obj
&lt;&lt;
 /Type /Pages
 /Kids [4 0 R]
 /Count 1
&gt;&gt;
endobj

4 0 obj
&lt;&lt;
 /Type /Page
 /Parent 3 0 R
 /MediaBox [0 0 612 792]
 /Contents 5 0 R
 /Resources
 &lt;&lt; /ProcSet 6 0 R
    /Font &lt;&lt; /F1 7 0 R &gt;&gt;
 &gt;&gt;
&gt;&gt;
endobj

5 0 obj
&lt;&lt; /Length 48 &gt;&gt;
stream
BT
/F1 24 Tf
100 700 Td
(Hello World)Tj
ET
endstream
endobj

6 0 obj
[/PDF /Text]
endobj

7 0 obj
&lt;&lt;
 /Type /Font
 /Subtype /Type1
 /Name /F1
 /BaseFont /Helvetica
 /Encoding /MacRomanEncoding
&gt;&gt;
endobj

xref
0 8
0000000000 65535 f
0000000012 00000 n
0000000089 00000 n
0000000145 00000 n
0000000214 00000 n
0000000381 00000 n
0000000485 00000 n
0000000518 00000 n
trailer
&lt;&lt;
 /Size 8
 /Root 1 0 R
&gt;&gt;
startxref
642
%%EOF
</pre></div>
</td></tr></tbody></table>

<p>Lets break the PDF down into sections and explain them a little bit more.</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>%PDF-1.7
</pre></div>

<p>This is the one line header section and all it does is declare the file as a PDF file of version 1.7.</p>
<p>Next we have the body of the PDF document. The body is a sequence of objects that make up the document. There are 8 types of objects and each one listed in the body is an indirect object. An indirect object is a labelled object, so that it may be called by other objects. The body of the PDF document is made up of dictionary objects. A dictionary object is an associative table containing pairs of objects (known as <em>entries</em>) represented by a <em>key</em> and a <em>value</em>. The key must be a name and the value may be of any kind (including another dictionary). The keys in a single dictionary must be unique. A dictionary is written as a sequence of key-value pairs enclosed in double angle brackets (&lt;&lt;) and (&gt;&gt;).</p>
<p>Lets take a look at the first object in our file:</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>1 0 obj
&lt;&lt;
 /Type /Catalog
 /Outlines 2 0 R
 /Pages 3 0 R
&gt;&gt;
endobj
</pre></div>
</td></tr></tbody></table>

<p>Line 3 declares the indirect object and 9 ends it. An indirect object is defined as</p>
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>X Y obj
ExampleObject
endobj
</pre></div>

<ul>
<li>X is referred to as the <em>object number</em></li>
<li>Y is referred to as the <em>generation number</em>. The generation number refers to the generation (version) of the PDF document as PDF documents may be incrementally updated.</li>
</ul>
<p>Inside the object declaration is the dictionary itself.</p>
<ul>
<li>Lines 4 and 8 start and end the dictionary.</li>
<li>Line 5 describes the type of the dictionary object.</li>
</ul>
<p>We see that the type is a Catalog type. This is a special (required) type and is the root of the document. The catalog contains references to other objects defining the document's contents, outlines, and other attributes. A Catalog dictionary contains two required entires:</p>
<ul>
<li><em>Type</em> always has a value of Catalog (by definition).</li>
<li><em>Pages</em> points to the object that is the root of the page tree. The page tree contains references to each page, and each page contains references to the content that makes up that page such as strings and images (see image above).</li>
</ul>
<p>Outlines, an optional entry, references the root of the outline hierarchy. The document outline consists of a tree-structured hierarchy of outline items (sometimes called bookmarks), which serve as a visual table of contents to display the documents structure to the user. Since Outlines and Pages both reference indirect objects, we can see how they are described.
The value <em>2 0 R</em> refers to an indirect object. This is called an indirect reference. The indirect reference consists of the object number, the generation number and the character R.</p>
<p>Lets look at the next object:</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>2 0 obj
&lt;&lt;
 /Type /Outlines
 /Count 0
&gt;&gt;
endobj
</pre></div>
</td></tr></tbody></table>

<p>This describes the document outline object. We see that this object has object number 2 and generation number 0. In addition the dictionary is described as the Outlines type. Count describes the total number of visible outline items at all levels of the outline.</p>
<p>Next we have object 3 which contains the dictionary for Pages, known as the Page Tree.</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>3 0 obj
&lt;&lt;
 /Type /Pages
 /Kids [4 0 R]
 /Count 1
&gt;&gt;
endobj
</pre></div>
</td></tr></tbody></table>

<p>Page tree nodes are made up of the following:</p>
<ul>
<li><em>Type</em> - (Required) which is always Pages for a page tree node.</li>
<li><em>Parent</em> - (Required - but it is prohibited in the root node) The page tree node that is the immediate parent of this one. We can tell that 3 is the root page tree node because it does not list a <em>Parent</em> entry.</li>
<li><em>Kids</em> - (Required) An array of indirect references to the immediate children of this node. In this case the node has 1 Kid and it is object 4.</li>
<li><em>Count</em> - (Required) The number of leaf nodes (page objects) that are descendants of this node within the page tree</li>
</ul>
<p>This brings us to the page object. The source for our one page object is:</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>4 0 obj
&lt;&lt;
 /Type /Page
 /Parent 3 0 R
 /MediaBox [0 0 612 792]
 /Contents 5 0 R
 /Resources
 &lt;&lt; /ProcSet 6 0 R
    /Font &lt;&lt; /F1 7 0 R &gt;&gt;
 &gt;&gt;
&gt;&gt;
endobj
</pre></div>
</td></tr></tbody></table>

<p>The page object is a dictionary specifying the attributes of a single page of the document. Lets discus the entries which have not been described previously.</p>
<ul>
<li><em>MediaBox</em> - (Required, inheritable) - Includes a Rectangle Object which describes "bounding boxes" for the object.</li>
<li><em>Contents</em> (Optional) - A content stream that describe the contents of this page.</li>
<li><em>Resources</em>(Required, inheritable) - A dictionary containing any resources required by the page. Here we have two entries in resources:</li>
<li><em>ProcSet</em> - References the object that describes the procedure sets</li>
<li><em>Font</em> - A dictionary that maps resource names to font dictionaries. In this case a font named F1 located in object 7.</li>
</ul>
<p>Next we have object 5, which contains the content stream of our page.</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>5 0 obj
&lt;&lt; /Length 48 &gt;&gt;
stream
BT
/F1 24 Tf
100 700 Td
(Hello World)Tj
ET
endstream
endobj
</pre></div>
</td></tr></tbody></table>

<p>The dictionary in this object describes only the length of the stream.</p>
<p>Next we see how the text is shown. It should be noted that the Text uses operators and operands. The operand (the object that is acted on) precedes the operator. In mathematics, we see this with the square root operator. If 5^2 is written, we know that 5 (the operand) is to be squared (the operator).</p>
<ul>
<li>On lines 41 and 47 we see the declaration for starting and ending the stream.</li>
<li>Line 42 and 46 (BT and ET) begin and end the text object.</li>
<li>Line 43 specifies the font and font size to use (the operand). <em>Tf</em> is the operator and specifies the name of the font resource, that is, an entry in the Font subdictionary of the current resource dictionary.</li>
<li>Line 44 specifies the starting position for the text on the page. <em>Td</em> is a text-positioning operator, and helps determine the location of the text.</li>
<li>Line 45 contains the String, enclosed in parentheses, to be displayed.<em>Tj</em> takes a string operand and paints it using the font and other text related parameters.</li>
</ul>
<p>Next we look at object 6.</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">50
51
52</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>6 0 obj
[/PDF /Text]
endobj
</pre></div>
</td></tr></tbody></table>

<p>We remember that this object was referenced by object 4 (the page node) in the resource dictionary under the <em>ProcSet</em> key. The PDF operators used in content streams are grouped into categories of related operators called Procedure Sets. This object holds an array (declared by the right and left brackets [ ]) of two procedure sets called PDF and Text. It should be noted that as of PDF version 1.4 this information is not used by the reader, but is still generated so that older readers may work.</p>
<p>The final object is object 7, shown below.</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>7 0 obj
&lt;&lt;
 /Type /Font
 /Subtype /Type1
 /Name /F1
 /BaseFont /Helvetica
 /Encoding /MacRomanEncoding
&gt;&gt;
endobj
</pre></div>
</td></tr></tbody></table>

<p>Object 7 was also referenced by object 4 (the page node) in the resources dictionary as the value to the Font key. The entries listed in this object are straightforward, and notice that the name <em>/F1</em> is the same one referenced throughout the document.</p>
<p>This brings us to the cross-reference table. The cross-reference table lists the information that permits access to indirect objects within the file. Listing the file in this way allows a reader to read parts of the file before reading the entire thing (know as Random Access). The cross-reference table is shown below.</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>xref
0 8
0000000000 65535 f
0000000012 00000 n
0000000089 00000 n
0000000145 00000 n
0000000214 00000 n
0000000381 00000 n
0000000485 00000 n
0000000518 00000 n
</pre></div>
</td></tr></tbody></table>

<p>Line 64 declares the start of the cross-reference table. The next line introduces the cross-reference subsection. For a file that has never been incrementally updated (such as this one), there will be only one cross-reference subsection. Each cross-reference subsection contains entries for a contiguous range of object numbers. The subsection begins with a line containing two numbers. The first (0 in our case) is the object number of the first object and the second (8) contains the number of objects in that subsection. Lines 66 through 73 contain the cross-reference entries themselves, one per line. Lines are constructed as followes:</p>
<ul>
<li>If an entry is <em>free</em>
..- The entry should end with an f
..- The first group of 10 numbers should be the (0 padded) object number of the next free object
..- The group of 5 numbers should be the 5-digit generation number</li>
<li>If an entry is <em>in use</em>
..- The entry should end with a u
..- The first group of 10 numbers should be the (0 padded) byte offset in the stream
..- The group of 5 numbers should be the 5-digit generation number</li>
</ul>
<p>The first entry in the table will always be free and shall have a generation number of 65,535. If it is the only free object (as in our case), it will have 0000000000 (itself) as the listing to the next free object.</p>
<p>Finally, the PDF file ends with the file trailer. The file trailer links to the cross-reference table and other special objects.</p>
<table class="highlighttable"><tbody><tr><td><div class="linenodiv" style="background-color: #f0f0f0; padding-right: 10px"><pre style="line-height: 125%">74
75
76
77
78
79
80
81</pre></div></td><td class="code"><div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>trailer
&lt;&lt;
 /Size 8
 /Root 1 0 R
&gt;&gt;
startxref
642
%%EOF
</pre></div>
</td></tr></tbody></table>

<p>The trailer is declared by the word <em>trailer</em>. Next we see the <em>trailer dictionary:</em>.
    -<em>Size</em> - Contains the total number of entries in the files cross-reference table
    -<em>Root</em> - Contains the indirect reference to the root (catalog dictionary) of the document.
After the trailer dictionary is the <em>startxref</em> keyword, which gives the byte-offset to the xref keyword. Finally, <em>%%EOF</em> declares the end of the PDF document.</p>
    <div>
        <p class="text-muted">published on 2012-01-22 by alex</p>
    </div>
</div>

    </div>

    <div class="col-sm-4 ">
      <div class="sidebar-module">
        <a href="https://amccormack.net/index.html">Home</a> • <a href="https://amccormack.net/feed.xml">Feed</a>
      </div>
      
      <div class="sidebar-module sidebar-module-inset">
        <h4> About Alex McCormack</h4>
        <div> I've been in information security for a few years. Areas include malware analysis, mobile security, incident response, penetration testing, and capture the flag development. I write a lot of python.
        <br>
        Email me at <pre>python -c 'import base64;print base64.decodestring("YWxleEBhbWNjb3JtYWNrLm5ldA==")'</pre>
        </div>
      </div>
      <div class="sidebar-module">
        <h4> <a href="https://amccormack.net/posts.html">All Posts</a> </h4>
        <h4> Recent Posts </h4>
        <ul>
        
            <li>
                <a href="https://amccormack.net/2017-07-13-new-website-architecture.html">New Website Architecture</a>
            </li>
        
            <li>
                <a href="https://amccormack.net/2016-03-19-spot-the-python-bug.html">Spot The Python Bug</a>
            </li>
        
            <li>
                <a href="https://amccormack.net/2015-06-16-chrome-new-browser-window-multiple-tabs.html">Creating a new browser window with multiple tabs in Chrome</a>
            </li>
        
            <li>
                <a href="https://amccormack.net/2015-01-13-insomnihack-2015-teaser-ynos.post.html">Insomni'hack 2015 Teaser - YNOS Web challenge</a>
            </li>
        
            <li>
                <a href="https://amccormack.net/2015-01-08-fixing-vpn-subsystem-error-with-cisco-anyconnect.html">Fixing VPN Subsystem Error with Cisco AnyConnect</a>
            </li>
        
        </ul>
      </div>
      <div class="sidebar-module">
        <iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" class="twitter-timeline twitter-timeline-rendered" style="position: static; visibility: visible; display: inline-block; width: 520px; height: 600px; padding: 0px; border: none; max-width: 100%; min-width: 180px; margin-top: 0px; margin-bottom: 0px; min-height: 200px;" data-widget-id="504848145176485888" title="Twitter Timeline" src="./Anatomy of a PDF document _ amccormack.net_files/saved_resource.html"></iframe>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>


      </div>
    </div>

  </div>
</div>

<div class="footer">
    <p class="text-muted">powered by <a href="https://github.com/botherder/habu">habu</a>.</p>
</div>

<iframe scrolling="no" frameborder="0" allowtransparency="true" src="./Anatomy of a PDF document _ amccormack.net_files/widget_iframe.83d5793f6ebbe2046330abda6016ae93.html" style="display: none;"></iframe><iframe id="rufous-sandbox" scrolling="no" frameborder="0" allowtransparency="true" allowfullscreen="true" style="position: absolute; visibility: hidden; display: none; width: 0px; height: 0px; padding: 0px; border: none;" title="Twitter analytics iframe" src="./Anatomy of a PDF document _ amccormack.net_files/saved_resource(1).html"></iframe></body></html>